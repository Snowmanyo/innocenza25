<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»£è³¼åœ˜è¨‚å–®å¡«å¯«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 10px;
            color: #2c3e50;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }

        .form-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 18px;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #546e7a;
            font-size: 14px;
            font-weight: 600;
        }

        .required {
            color: #e74c3c;
            margin-left: 3px;
        }

        input, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
            background: #f8f9fa;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .products-grid {
            display: grid;
            gap: 8px;
        }

        .product-item {
            background: #f8f9fa;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
        }

        .product-item:hover {
            background: white;
            border-color: #667eea;
        }

        .product-item.selected {
            background: linear-gradient(135deg, #e8ebfd 0%, #f0e6fa 100%);
            border-color: #667eea;
        }

        .product-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .product-info {
            flex: 1;
            min-width: 0;
        }

        .product-title {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .product-num {
            background: #667eea;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .product-name-text {
            font-weight: 600;
            color: #2c3e50;
            font-size: 14px;
        }

        .product-variant {
            font-size: 18px;
            margin-left: 4px;
        }

        .product-price-text {
            color: #7f8c8d;
            font-size: 12px;
        }

        .quantity-selector {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .qty-option {
            width: 32px;
            height: 32px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .qty-option:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .qty-option.selected {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .product-group {
            margin-bottom: 15px;
        }

        .product-group-title {
            font-size: 15px;
            font-weight: 600;
            color: #2c3e50;
            padding: 8px 12px;
            background: #ecf0f1;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-top: 20px;
        }

        .summary-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .summary-row:last-child {
            margin-bottom: 0;
        }

        .summary-total {
            font-size: 24px;
            font-weight: 700;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }

        .gift-card-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 12px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-size: 15px;
            font-weight: 600;
        }

        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .success-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            margin: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .success-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .success-title {
            font-size: 24px;
            color: #2c3e50;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .success-message {
            color: #7f8c8d;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .close-btn {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .error-message {
            background: #ffe6e6;
            color: #e74c3c;
            padding: 12px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 768px) {
            body {
                padding: 15px 8px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .form-section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>DAY6 è–èª•æ§ç·šä¸‹å‘¨é‚Šä»£è³¼ ğŸ„</h1>
            <div style="text-align: left; line-height: 1.8; color: #2c3e50; font-size: 14px; margin-top: 15px;">
                <strong style="color: #667eea; font-size: 15px;">ğŸ“‹ ä»£è³¼è¦å‰‡</strong><br>
                <div style="margin-top: 10px;">
                    âœ“ å•†å“é‡‘é¡å¦‚ä¸‹æ–¹è¡¨å–®ï¼Œä¸ç”¨äºŒè£œ<br>
                    âœ“ æ»¿ â‚©50,000 å¯å¾—ä¸€å¼µæ»¿é¡å¡ï¼Œâ‚©100,000 å…©å¼µï¼Œä»¥æ­¤é¡æ¨<br>
                    âœ“ æ»¿é¡å¡å¯è¨±é¡˜ï¼Œç›¡é‡é…åˆä½†ä¸ä¿è­‰<br>
                    âœ“ éœ€å…ˆåŒ¯æ¬¾å…¨é¡ï¼Œä¸‹å–®å¾Œè«‹ç§è¨Š FB å–å¾—åŒ¯æ¬¾å¸³è™Ÿ<br>
                    âœ“ è‹¥æ²’è²·åˆ°æœƒé€€æ¬¾ï¼Œè·¨è¡Œæ‰‹çºŒè²»è«‹è‡ªè¡Œè² æ“”<br>
                    âœ“ åŒ¯æ¬¾å¾Œè¨‚å–®æ‰ç®—æˆç«‹ï¼Œæœƒä¾è¨‚å–®æˆç«‹çš„å„ªå…ˆé †åºé…è²¨<br>
                    âœ“ è‹¥æœ‰è²·åˆ°æœƒé–‹ 20 å…ƒè³£è²¨ä¾¿è«‹æ‚¨ä¸‹å–®<br>
                    âœ“ éƒ¨åˆ†å•†å“æœ‰ç›’è£ï¼Œå¯èƒ½æœƒæ‹†ç›’é¿å…å¤–ç›’æå£<br>
                    âœ“ é»˜èªå» æï¼Œç„¡æ³•é€€æ›è²¨<br>
                    âœ“ æœƒä½¿ç”¨äºŒæ‰‹åŒ…æ<br>
                    âš ï¸ <strong style="color: #e74c3c;">ç¦æ­¢æ£„å–®ï¼Œä¸å¯ç„¡ A ä¸æ”¶ B</strong>
                </div>
                
                <!-- åŒæ„è¦å‰‡ -->
                <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border: 2px solid #ffc107;">
                    <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer; margin: 0;">
                        <input 
                            type="checkbox" 
                            id="agreeRulesHeader" 
                            required
                            style="width: 20px; height: 20px; margin-top: 2px; cursor: pointer; flex-shrink: 0;"
                        >
                        <span style="color: #856404; font-size: 14px; line-height: 1.6;">
                            <strong>æˆ‘å·²è©³ç´°é–±è®€ä¸¦åŒæ„ä»¥ä¸Šæ‰€æœ‰ä»£è³¼è¦å‰‡</strong><br>
                        </span>
                    </label>
                </div>
            </div>
        </div>

        <form id="orderForm">
            <!-- å®¢äººè³‡æ–™ -->
            <div class="form-section">
                <div class="section-title">
                    ğŸ‘¤ åŸºæœ¬è³‡æ–™
                </div>
                <div class="form-group">
                    <label>FB åç¨± <span class="required">*</span></label>
                    <input type="text" id="customerName" required placeholder="è«‹è¼¸å…¥æ‚¨çš„ Facebook åç¨±">
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">
                        â€» æˆ‘å€‘æœƒé€é FB ç§è¨Šèˆ‡æ‚¨è¯ç¹«ï¼Œä¸¦æä¾›åŒ¯æ¬¾å¸³è™Ÿ
                    </div>
                </div>
            </div>

            <!-- å•†å“é¸æ“‡ -->
            <div class="form-section">
                <div class="section-title">
                    ğŸ›’ é¸æ“‡å•†å“
                </div>
                <div class="products-grid" id="productsContainer">
                    <!-- å•†å“å¡ç‰‡æœƒå‹•æ…‹ç”¢ç”Ÿ -->
                </div>
            </div>

            <!-- å‚™è¨»æ¬„ä½ -->
            <div class="form-section">
                <div class="section-title">
                    ğŸ“ å‚™è¨»
                </div>
                <div class="form-group" style="margin-bottom: 0;">
                    <label>å‚™è¨»äº‹é …ï¼ˆé¸å¡«ï¼‰</label>
                    <textarea id="orderNote" placeholder="ä¾‹å¦‚ï¼šæ»¿é¡å¡æƒ³è¦çš„é †åºã€ç‰¹æ®Šéœ€æ±‚ç­‰" style="min-height: 100px;"></textarea>
                    <div style="font-size: 12px; color: #7f8c8d; margin-top: 8px; line-height: 1.5;">
                        ğŸ’¡ æç¤ºï¼šå¦‚æœæ‚¨æœ‰ç²å¾—æ»¿é¡å¡ï¼Œå¯ä»¥åœ¨é€™è£¡è¨»æ˜æƒ³è¦çš„æ¬¾å¼å„ªå…ˆé †åº<br>
                        ä¾‹å¦‚ï¼šã€Œæ»¿é¡å¡å„ªå…ˆé †åºï¼šğŸ» > ğŸ¦Š > ğŸ° > ğŸ¶ã€
                    </div>
                </div>
            </div>

            <!-- è¨‚å–®æ‘˜è¦ -->
            <div class="form-section">
                <div class="section-title">
                    ğŸ“‹ è¨‚å–®æ‘˜è¦
                </div>
                <div id="orderSummary" style="color: #7f8c8d; font-size: 14px;">
                    å°šæœªé¸æ“‡å•†å“
                </div>
                <div class="summary-box" id="summaryBox" style="display: none;">
                    <div class="summary-title">æ‚¨çš„è¨‚å–®</div>
                    <div id="summaryItems"></div>
                    <div class="summary-total">
                        <div class="summary-row">
                            <span>ç¸½è¨ˆ</span>
                            <span id="totalAmount">$0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="error-message" id="errorMessage"></div>

            <button type="submit" class="submit-btn" id="submitBtn">
                ç¢ºèªé€å‡ºè¨‚å–®
            </button>
        </form>
    </div>

    <!-- æˆåŠŸæç¤º -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">âœ…</div>
            <div class="success-title">è¨‚å–®å·²é€å‡ºï¼</div>
            <div class="success-message" style="line-height: 1.8;">
                æ„Ÿè¬æ‚¨çš„è¨‚è³¼ï¼<br><br>
                <strong style="color: #667eea;">ğŸ“© ä¸‹ä¸€æ­¥ï¼š</strong><br>
                è«‹ç«‹å³ç§è¨Š <strong>Facebook</strong> <br>
                æˆ‘å€‘æœƒæä¾›åŒ¯æ¬¾å¸³è™Ÿçµ¦æ‚¨<br><br>
                <strong style="color: #e74c3c;">âš ï¸ é‡è¦æé†’ï¼š</strong><br>
                åŒ¯æ¬¾å¾Œè¨‚å–®æ‰ç®—æ­£å¼æˆç«‹<br>
                æˆ‘å€‘æœƒä¾å„ªå…ˆé †åºç‚ºæ‚¨é…è²¨
            </div>
            <button class="close-btn" onclick="closeSuccessModal()">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // Apps Script ç¶²å€ - èˆ‡å¾Œå°ä½¿ç”¨åŒä¸€å€‹
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzPvr2fCNwvp-PVJ3bEnIrRDbNX1cYUBHG-5faNYb98FmWL8X0UPK_robDZpuDHTM3PMA/exec';

        const products = [
            { id: 1, name: "ç·¨ç¹”åŠé£¾å¨ƒ", krw: 18000, price: 500, variants: ["ğŸ»", "ğŸ¦Š", "ğŸ°", "ğŸ¶"] },
            { id: 2, name: "æŠ«è‚©æ¯¯", krw: 49000, price: 1250, variants: ["ğŸ»", "ğŸ¦Š", "ğŸ°", "ğŸ¶"] },
            { id: 3, name: "é›™é¢åŒ…", krw: 27000, price: 720, variants: ["ğŸ»", "ğŸ¦Š", "ğŸ°", "ğŸ¶"] },
            { id: 4, name: "è–èª•è·³èˆå¨ƒ", krw: 38000, price: 980, variants: ["ğŸ»", "ğŸ¦Š", "ğŸ°", "ğŸ¶"] },
            { id: 5, name: "æ¯›çµ¨å¾½ç« (éš¨æ©Ÿ)", krw: 7900, price: 220, variants: [] },
            { id: 6, name: "è¡Œå‹•é›»æº", krw: 29000, price: 800, variants: ["ğŸ»", "ğŸ¦Š", "ğŸ°", "ğŸ¶"] },
            { id: 7, name: "éš¨æ©Ÿå¡åŒ…", krw: 6000, price: 180, variants: [] },
            { id: 8, name: "ç…§ç‰‡çµ„", krw: 18000, price: 480, variants: ["ğŸ»", "ğŸ¦Š", "ğŸ°", "ğŸ¶"] },
            { id: 9, name: "æ˜ä¿¡ç‰‡ï¼‹ç´™è† å¸¶çµ„", krw: 20000, price: 520, variants: [] },
            { id: 10, name: "åœå·¾", krw: 29000, price: 760, variants: [] },
            { id: 11, name: "é€£å¸½å¤–å¥—", krw: 84000, price: 2200, variants: ["M", "XL"] },
            { id: 12, name: "é‡ç¹”è¡«", krw: 58000, price: 1500, variants: [] },
            { id: 13, name: "925éŠ€æ‰‹éŠ", krw: 50000, price: 1250, variants: [] },
            { id: 14, name: "é›ªèŠ±çƒç£éµ", krw: 28000, price: 750, variants: [] }
        ];

        let selectedItems = {};

        function getProductNumber(productId, variant) {
            const product = products.find(p => p.id === productId);
            if (!product) return '';
            
            if (!variant || product.variants.length === 0) {
                return `${productId}`;
            }
            
            const variantIndex = product.variants.indexOf(variant);
            return variantIndex !== -1 ? `${productId}-${variantIndex + 1}` : `${productId}`;
        }

        function renderProducts() {
            const container = document.getElementById('productsContainer');
            
            products.forEach(product => {
                if (product.variants && product.variants.length > 0) {
                    // æœ‰è®Šé«”çš„å•†å“ - æ¯å€‹è®Šé«”ä¸€è¡Œ
                    const group = document.createElement('div');
                    group.className = 'product-group';
                    
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'product-group-title';
                    groupTitle.textContent = `${product.id}. ${product.name} - $${product.price}`;
                    group.appendChild(groupTitle);
                    
                    product.variants.forEach((variant, idx) => {
                        const item = createProductItem(product, variant, idx);
                        group.appendChild(item);
                    });
                    
                    container.appendChild(group);
                } else {
                    // ç„¡è®Šé«”çš„å•†å“ - åŠ ä¸Šåˆ†çµ„æ¨™é¡Œ
                    const group = document.createElement('div');
                    group.className = 'product-group';
                    
                    const groupTitle = document.createElement('div');
                    groupTitle.className = 'product-group-title';
                    groupTitle.textContent = `${product.id}. ${product.name} - $${product.price}`;
                    group.appendChild(groupTitle);
                    
                    const item = createProductItem(product, null, 0);
                    group.appendChild(item);
                    
                    container.appendChild(group);
                }
            });
        }

        function createProductItem(product, variant, variantIdx) {
            const item = document.createElement('div');
            item.className = 'product-item';
            
            const key = variant ? `${product.id}-${variant}` : `${product.id}`;
            const productNum = variant ? `${product.id}-${variantIdx + 1}` : `${product.id}`;
            
            // æ ¹æ“šå•†å“æ±ºå®šæ•¸é‡é¸é …
            let qtyOptions = [1, 2, 3, 4, 5];
            if (product.id === 5) { // æ¯›çµ¨å¾½ç« 
                qtyOptions = [1, 2, 3, 4, 5, 6, 7, 8];
            } else if (product.id === 7) { // éš¨æ©Ÿå¡åŒ…
                qtyOptions = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            }
            
            item.innerHTML = `
                <input 
                    type="checkbox" 
                    class="product-checkbox" 
                    id="check-${key}"
                    onchange="toggleProduct('${key}', ${product.id}, '${variant || ''}', ${product.price}, ${product.krw}, '${product.name}')"
                >
                <label for="check-${key}" class="product-info">
                    <div class="product-title">
                        <span class="product-num">${productNum}</span>
                        <span class="product-name-text">
                            ${variant ? `<span class="product-variant">${variant}</span>` : product.name}
                        </span>
                    </div>
                </label>
                <div class="quantity-selector" id="qty-${key}" style="display: none;">
                    ${qtyOptions.map(num => `
                        <button type="button" class="qty-option" data-qty="${num}" onclick="selectQuantity('${key}', ${num}, event)">
                            ${num}
                        </button>
                    `).join('')}
                </div>
            `;
            
            return item;
        }

        function toggleProduct(key, productId, variant, price, krw, name) {
            const checkbox = document.getElementById(`check-${key}`);
            const qtySelector = document.getElementById(`qty-${key}`);
            const item = checkbox.closest('.product-item');
            
            if (checkbox.checked) {
                qtySelector.style.display = 'flex';
                item.classList.add('selected');
                // é è¨­é¸ 1
                selectQuantity(key, 1);
            } else {
                qtySelector.style.display = 'none';
                item.classList.remove('selected');
                // æ¸…é™¤é¸å–çš„æ•¸é‡
                qtySelector.querySelectorAll('.qty-option').forEach(btn => {
                    btn.classList.remove('selected');
                });
                delete selectedItems[key];
                updateSummary();
            }
        }

        function selectQuantity(key, quantity, event) {
            if (event) {
                event.stopPropagation();
                event.preventDefault();
            }
            
            const checkbox = document.getElementById(`check-${key}`);
            if (!checkbox.checked) {
                checkbox.checked = true;
                toggleProduct(key, null, null, null, null, null);
            }
            
            const qtySelector = document.getElementById(`qty-${key}`);
            qtySelector.querySelectorAll('.qty-option').forEach(btn => {
                if (parseInt(btn.dataset.qty) === quantity) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            
            // å¾ checkbox çš„ onchange å–å¾—å•†å“è³‡è¨Š
            const onchangeAttr = checkbox.getAttribute('onchange');
            const matches = onchangeAttr.match(/toggleProduct\('(.+?)', (\d+), '(.*?)', (\d+), (\d+), '(.+?)'\)/);
            
            if (matches) {
                const [, , productId, variant, price, krw, name] = matches;
                selectedItems[key] = {
                    productId: parseInt(productId),
                    productName: name,
                    variant: variant || null,
                    quantity: quantity,
                    price: parseInt(price),
                    krw: parseInt(krw)
                };
                
                updateSummary();
            }
        }

        function updateSummary() {
            const summaryBox = document.getElementById('summaryBox');
            const orderSummary = document.getElementById('orderSummary');
            const summaryItems = document.getElementById('summaryItems');
            
            const itemsArray = Object.values(selectedItems);
            
            if (itemsArray.length === 0) {
                summaryBox.style.display = 'none';
                orderSummary.style.display = 'block';
                return;
            }
            
            summaryBox.style.display = 'block';
            orderSummary.style.display = 'none';
            
            const totalAmount = itemsArray.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalKrw = itemsArray.reduce((sum, item) => sum + (item.krw * item.quantity), 0);
            const giftCards = Math.floor(totalKrw / 50000);
            
            let itemsHTML = itemsArray.map(item => {
                const displayName = item.variant ? 
                    `${item.productName} ${item.variant}` : 
                    item.productName;
                return `
                    <div class="summary-row">
                        <span>${displayName} Ã— ${item.quantity}</span>
                        <span>$${(item.price * item.quantity).toLocaleString()}</span>
                    </div>
                `;
            }).join('');
            
            // å¦‚æœæœ‰æ»¿é¡å¡ï¼ŒåŠ åœ¨å•†å“é …ç›®å¾Œé¢
            if (giftCards > 0) {
                itemsHTML += `
                    <div class="summary-row" style="color: #f39c12; font-weight: 600; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px; margin-top: 10px;">
                        <span>ğŸ æ»¿é¡å¡</span>
                        <span>Ã— ${giftCards}</span>
                    </div>
                `;
            }
            
            summaryItems.innerHTML = itemsHTML;
            
            document.getElementById('totalAmount').textContent = `NT$ ${totalAmount.toLocaleString()}`;
        }

        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const customerName = document.getElementById('customerName').value.trim();
            const orderNote = document.getElementById('orderNote').value.trim();
            const agreeRules = document.getElementById('agreeRulesHeader').checked;
            const errorMsg = document.getElementById('errorMessage');
            const submitBtn = document.getElementById('submitBtn');
            
            if (!agreeRules) {
                errorMsg.textContent = 'è«‹å…ˆå‹¾é¸åŒæ„ä»£è³¼è¦å‰‡ï¼ˆåœ¨æœ€ä¸Šæ–¹ï¼‰';
                errorMsg.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
                return;
            }
            
            if (!customerName) {
                errorMsg.textContent = 'è«‹å¡«å¯« FB åç¨±';
                errorMsg.style.display = 'block';
                return;
            }
            
            const itemsArray = Object.values(selectedItems);
            
            if (itemsArray.length === 0) {
                errorMsg.textContent = 'è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å•†å“';
                errorMsg.style.display = 'block';
                return;
            }
            
            errorMsg.style.display = 'none';
            submitBtn.disabled = true;
            submitBtn.textContent = 'é€å‡ºä¸­...';
            
            try {
                // å°‡é¸ä¸­çš„å“é …æ‹†æˆæ¯å€‹æ•¸é‡1çš„ç¨ç«‹å“é …
                const items = [];
                itemsArray.forEach(item => {
                    for (let i = 0; i < item.quantity; i++) {
                        items.push({
                            productId: item.productId,
                            productName: item.productName,
                            variant: item.variant,
                            quantity: 1,
                            price: item.price,
                            krw: item.krw,
                            purchased: false,
                            priority: 0 // å¾Œå°æœƒé‡æ–°è¨ˆç®—
                        });
                    }
                });
                
                const order = {
                    action: 'addOrder',
                    order: {
                        id: Date.now(),
                        customerName: customerName,
                        customerPhone: '', // ä¸å†ä½¿ç”¨
                        customerContact: orderNote, // å‚™è¨»å­˜åœ¨é€™è£¡
                        items: items,
                        createdAt: new Date().toISOString()
                    }
                };
                
                // é€å‡ºåˆ°å¾Œå°
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(order)
                });
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                document.getElementById('successModal').style.display = 'flex';
                
                // æ¸…ç©ºè¡¨å–®
                setTimeout(() => {
                    document.getElementById('orderForm').reset();
                    selectedItems = {};
                    // å–æ¶ˆæ‰€æœ‰å‹¾é¸
                    document.querySelectorAll('.product-checkbox').forEach(cb => {
                        cb.checked = false;
                    });
                    document.querySelectorAll('.product-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    document.querySelectorAll('.quantity-selector').forEach(qs => {
                        qs.style.display = 'none';
                        qs.querySelectorAll('.qty-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                    });
                    updateSummary();
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ç¢ºèªé€å‡ºè¨‚å–®';
                }, 2000);
                
            } catch (error) {
                console.error('é€å‡ºå¤±æ•—:', error);
                errorMsg.textContent = 'é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
                errorMsg.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'ç¢ºèªé€å‡ºè¨‚å–®';
            }
        });

        function closeSuccessModal() {
            document.getElementById('successModal').style.display = 'none';
        }

        // åˆå§‹åŒ–
        renderProducts();
    </script>
</body>
</html>
